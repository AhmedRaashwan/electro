<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
  <link rel="icon" type="image/x-icon" href="https://ahmedraashwan.github.io/electro/favicon.ico">
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-messaging-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
    .animate-pulse:hover { animation: pulse 0.3s ease-in-out; }
    .loading-icon { animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen p-4 transition-colors duration-300">
  <div class="container bg-white dark:bg-gray-800 max-w-md w-full rounded-2xl shadow-lg p-6 text-center animate-fadeIn">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠØ© Ø§Ù„Ø¢Ù„ÙŠ</h2>
    <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">ÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„ØªØµÙ„Ùƒ Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹.</p>
    <button id="enable-notifications" onclick="requestPermission()" class="btn w-full flex items-center justify-center gap-2 py-3 bg-blue-600 text-white font-semibold text-base rounded-xl hover:bg-blue-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-all duration-300 animate-pulse">
      <span id="button-icon" class="text-xl">ğŸ””</span>
      <span id="button-text">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
      <span id="loading-icon" class="loading-icon hidden text-xl">â³</span>
    </button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA2abvzifuMGk-tQEO8uymc08i8NvMAHwI",
      authDomain: "notify-raa.firebaseapp.com",
      projectId: "notify-raa",
      storageBucket: "notify-raa.firebasestorage.app",
      messagingSenderId: "767633213120",
      appId: "1:767633213120:web:0a19231dc1f04e3ced0f25",
      measurementId: "G-SQ4T5Q0WN0"
    };
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    const appsScriptUrl = "https://script.google.com/macros/s/AKfycbw1oGm7iwjYxS4ZEmcfhK1P3-121SdqkGootUlspBCfWmaBwvZAUJejr2Nfox4KVHs/exec";

    async function requestPermission() {
      const button = document.getElementById('enable-notifications');
      const buttonIcon = document.getElementById('button-icon');
      const buttonText = document.getElementById('button-text');
      const loadingIcon = document.getElementById('loading-icon');

      button.disabled = true;
      buttonIcon.classList.add('hidden');
      buttonText.classList.add('hidden');
      loadingIcon.classList.remove('hidden');

      try {
        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          alert("âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
          return;
        }

        const swReg = await navigator.serviceWorker.register('https://ahmedraashwan.github.io/electro/firebase-messaging-sw.js');
        console.log("âœ… Service Worker registered", swReg);

        const token = await messaging.getToken({
          vapidKey: "BFmDP36OqzBy-Lp8HANsCWYJmZkukVyAneLRi6miHMv7UXvW0zpKRxcw7j33UQKoiU6OMRnnP2t8O_sPW1DMjR0",
          serviceWorkerRegistration: swReg
        });
        console.log("ğŸ¯ FCM Token:", token);

        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = `${appsScriptUrl}?token=${encodeURIComponent(token)}`;
        document.body.appendChild(iframe);

        alert("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ­ÙØ¸ Ø§Ù„Ø±Ù…Ø² Ø¨Ù†Ø¬Ø§Ø­");

      } catch (err) {
        console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†:", err);
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
      } finally {
        button.disabled = false;
        buttonIcon.classList.remove('hidden');
        buttonText.classList.remove('hidden');
        loadingIcon.classList.add('hidden');
      }
    }

    messaging.onMessage((payload) => {
      console.log("ğŸ“¬ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø±Ø¯Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©:", payload);
    });
  </script>
</body>
</html>
