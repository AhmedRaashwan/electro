<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة التقارير</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging.js"></script>
  <style>
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .progress-bar {
      width: 50%;
      height: 20px;
      background: #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background: #3b82f6;
      transition: width 0.5s ease-in-out;
    }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fade-in 0.3s ease-out;
    }
    .image-container {
      min-width: 300px;
    }
    .image-container:hover img, .image-container:hover video {
      transform: scale(1.05);
    }
    .login-container {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100 font-sans">
  <div class="loading" id="loading">
    <div class="text-center text-white">
      <p class="text-xl mb-4">جاري التحميل...</p>
      <div class="progress-bar">
        <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <!-- Login Form -->
  <div class="login-container" id="loginForm">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">تسجيل الدخول</h2>
    <div class="mb-4">
      <button id="registerPush" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">تسجيل لتلقي الإشعارات</button>
    </div>
    <form id="loginFormInner">
      <div class="mb-4">
        <label for="email" class="block text-sm font-medium text-gray-600">البريد الإلكتروني:</label>
        <input type="email" id="email" name="email" placeholder="أدخل البريد الإلكتروني" required autocomplete="email" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div class="mb-4">
        <label for="password" class="block text-sm font-medium text-gray-600">كلمة المرور:</label>
        <input type="password" id="password" name="password" placeholder="أدخل كلمة المرور" required autocomplete="current-password" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
      </div>
      <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">تسجيل الدخول</button>
    </form>
    <div id="loginStatus" class="text-red-600 font-bold mt-4 text-center"></div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto p-6 max-w-7xl hidden" id="mainContent">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800">إدارة التقارير</h1>
      <div class="flex items-center gap-4">
        <h3 class="text-xl font-semibold text-gray-700" id="welcomeMessage">مرحبًا</h3>
        <button id="logoutButton" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">تسجيل الخروج</button>
      </div>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <div class="flex flex-col sm:flex-row gap-4 items-end">
        <div class="w-full sm:w-1/2 order-first">
          <label for="search-input" class="block text-lg font-medium text-gray-700">البحث:</label>
          <div class="flex gap-2">
            <input id="search-input" type="text" placeholder="ابحث في السجلات..." class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-200 text-lg">
            <button id="search-button" type="button" class="mt-1 bg-blue-600 text-white px-5 py-3 rounded-lg hover:bg-blue-700 transition duration-200 text-lg">بحث</button>
          </div>
        </div>
        <div class="w-full sm:w-1/2 flex flex-col sm:flex-row gap-4 order-last">
          <div class="w-full sm:w-1/2">
            <label for="status-filter" class="block text-lg font-medium text-gray-700">الحالة:</label>
            <div class="relative">
              <select id="status-filter" class="mt-1 block w-full p-3 bg-white border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 appearance-none transition duration-200 hover:border-blue-400 text-lg text-center">
                <option value="all">جميع الحالات</option>
                <option value="new" selected>جديد</option>
                <option value="done">منتهي</option>
                <option value="pending">معلق</option>
                <option value="cancelled">ملغى</option>
                <option value="ongoing">جاري</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
            </div>
          </div>
          <div class="w-full sm:w-1/2">
            <label for="date-filter" class="block text-lg font-medium text-gray-700">التاريخ:</label>
            <div class="relative">
              <select id="date-filter" class="mt-1 block w-full p-3 bg-white border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 appearance-none transition duration-200 hover:border-blue-400 text-lg text-center">
                <option value="all">جميع التواريخ</option>
                <option value="today">اليوم</option>
                <option value="week" selected>هذا الأسبوع</option>
                <option value="month">هذا الشهر</option>
                <option value="custom">مخصص</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="date-range-picker" class="hidden mt-4 flex flex-col sm:flex-row gap-4">
        <div>
          <label for="from-date" class="block text-lg font-medium text-gray-700">من:</label>
          <input id="from-date" type="date" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-200 text-lg">
        </div>
        <div>
          <label for="to-date" class="block text-lg font-medium text-gray-700">إلى:</label>
          <input id="to-date" type="date" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-200 text-lg">
        </div>
        <button id="go-button" type="button" class="self-end mt-4 sm:mt-7 bg-blue-600 text-white px-5 py-3 rounded-lg hover:bg-blue-700 transition duration-200 text-lg">تطبيق</button>
      </div>
    </div>
    <div id="error-message" class="text-red-600 font-bold mb-6 hidden"></div>
    <div id="stats-container" style="background: linear-gradient(to bottom, #e5e7eb, #d1d5db); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;"></div>
    <div id="cards" class="grid gap-6"></div>
    <div class="pagination flex justify-center gap-2 mt-6" id="pagination"></div>
    <div id="popup" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
      <div class="bg-white p-6 rounded-xl max-w-4xl max-h-[90vh] w-full overflow-auto shadow-2xl animate-fade-in">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">تفاصيل التقرير</h2>
        <button id="close-popup" class="mt-6 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200">إغلاق</button>
        <div id="popup-details"></div>
        <button id="close-popup-buttom" class="mt-6 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200">إغلاق</button>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "electro-12753.firebaseapp.com",
      projectId: "electro-12753",
      storageBucket: "electro-12753.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID",
      measurementId: "YOUR_MEASUREMENT_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    let currentPage = 1;

    function showLoading(show, progress = 0) {
      const loading = document.getElementById('loading');
      const progressBar = document.getElementById('progress-bar-fill');
      if (!loading || !progressBar) {
        console.error('عناصر التحميل غير موجودة');
        document.getElementById('error-message').classList.remove('hidden');
        document.getElementById('error-message').textContent = 'خطأ في التحميل';
        return;
      }
      loading.style.display = show ? 'flex' : 'none';
      progressBar.style.width = `${progress}%`;
      if (show) {
        let currentProgress = progress;
        const interval = setInterval(() => {
          currentProgress += 10;
          progressBar.style.width = `${currentProgress}%`;
          if (currentProgress >= 100 || loading.style.display === 'none') {
            clearInterval(interval);
          }
        }, 300);
      }
    }

    async function registerForPush() {
      try {
        const permission = await Notification
